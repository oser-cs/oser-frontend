<div id="visit" *ngIf="visit">
  <div class="text-center">
    <h1>{{ visit.title }}</h1>
    <p>
      <strong>{{ visit.date | date:"EEEE d MMMM" }} – {{ visit.date | date:"shortTime"}}</strong> – {{ visit.place.name }}
    </p>

    <!-- Metadata badges -->
    <div>
      <span *ngIf="visit.registrationsOpen" class="badge badge-warning badge-lg"><i class="fa fa-clock-o"></i>
        Inscriptions avant le {{ visit.deadline | date:"dd/MM à HH:mm" }}
      </span>
      <span *ngIf="!visit.registrationsOpen" class="badge badge-danger badge-lg">
        <i class="fa fa-times"></i> Inscriptions fermées
      </span>
      <span *ngIf="visit.participants.length > 0" class="badge badge-info badge-lg">
        <i class="fa fa-user"></i> {{ visit.participants.length }} participants
      </span>
    </div>

    <!-- Show register button if user does not participate -->
    <div *ngIf="visit.registrationsOpen && !userParticipates" class="text-center">
      <button id="participate-btn" type="button" name="button" class="btn-success" (click)="formActive = true">Je m'inscris</button>
    </div>

    <img id="illustration" [src]="visit.image" [alt]="visit.title" class="drop-shadow-sm">
  </div>

  <!-- If user participates, show them relevant info -->
  <div *ngIf="userParticipates">
    <p class="alert alert-success"><i class="fa fa-ticket"></i> Tu participes à cette sortie.</p>
    <p class="alert alert-default">
      <i class="fa fa-file-text"></i> Les organisateurs ont rédigé une <a [href]="visit.factSheet">fiche sortie</a>. Consulte-la avant de te rendre à la sortie !
    </p>
    <!-- And a shy-ish unregister link -->
    <p class="text-muted">Tu as un empêchement et souhaites <span class="link-muted" (click)="leave()">te désinscrire ?</span></p>
  </div>

  <div *ngIf="visit.summary">
    <h2>Résumé</h2>
    <p [innerHTML]="visit.summary | linebreaks"></p>
  </div>


  <!-- Modal register form -->
  <div id="register-form" class="modal" [hidden]="!formActive" (click)="clickModal($event)">
    <form name="form" class="modal-content" (ngSubmit)="participate()" novalidate>
      <h2>S'inscrire à {{ visit.title }}</h2>
      <div *ngIf="visit.attachedFiles  && visit.attachedFiles.length > 0; else noattachments">
        <p>Pour t'inscrire à cette sortie, nous avons besoin des documents suivants.</p>
        <ul>
          <li *ngFor="let item of visit.attachedFiles">
            {{ item.name }} <br />
            <input type="file" [name]="item.id">
          </li>
        </ul>
      </div>
      <ng-template #noattachments>
        <p>Aucune étape supplémentaire n'est requise pour t'inscrire à cette sortie.</p>
      </ng-template>
      <div class="text-center">
        <button class="btn-success">Confirmer mon inscription</button>
        <load-spinner *ngIf="formLoading"></load-spinner>
      </div>
    </form>
  </div>

  <div *ngIf="visit.description">
    <h2>Détail des activités</h2>
    <p [innerHTML]="visit.description"></p>
  </div>

  <h2>Informations pratiques</h2>

  <table class="tips">
    <tr>
      <td>Lieu</td>
      <td>{{ visit.place.name }}</td>
    </tr>
    <tr>
      <td>Adresse</td>
      <td>{{ visit.place.address.toString() }}</td>
    </tr>
    <tr>
      <td>Date</td>
      <td>{{ visit.date | date:"fullDate" }}</td>
    </tr>
    <tr>
      <td>Heure de rendez-vous</td>
      <td>{{ visit.date | date:"shortTime"}}</td>
    </tr>
  </table>

  <h3>Se rendre à cette sortie</h3>
  <agm-map [latitude]="lat" [longitude]="lng" [zoom]="17">
    <agm-marker [latitude]="lat" [longitude]="lng"></agm-marker>
  </agm-map>

  <h2>Tuteurs organisateurs</h2>

  <ul>
    <li *ngFor="let organizer of visit.organizers">
      {{ organizer.user.firstName }} {{ organizer.user.lastName}}
      <span *ngIf="organizer.user.phoneNumber">
        (tél. : <app-reveal [content]="organizer.user.phoneNumber"></app-reveal>)
      </span>
    </li>
  </ul>
  <div *ngIf="visit.place.description">
    <h3>À propos de {{ visit.place.name }}</h3>
    <markdown [data]="visit.place.description"></markdown>
  </div>

</div>
